(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{1776:(e,t,s)=>{"use strict";let r,i;s.d(t,{UU:()=>sx});class o extends Error{code;rawCode;constructor(e,t,s,r){void 0!==t&&(e=`${t}: ${e}`),super(e,{cause:r}),this.code=t,this.rawCode=s,this.name="LibsqlError"}}let n=RegExp("^(?<scheme>[A-Za-z][A-Za-z.+-]*):(//(?<authority>[^/?#]*))?(?<path>[^?#]*)(\\?(?<query>[^#]*))?(#(?<fragment>.*))?$","su"),a=RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function u(e){try{return decodeURIComponent(e)}catch(e){if(e instanceof URIError)throw new o(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e);throw e}}function l(e,t,s){var r,i;if(void 0===t)throw new o(`URL with scheme ${JSON.stringify(e+":")} requires authority (the "//" part)`,"URL_INVALID");let n=`${e}:`,a=(r=t.host).includes(":")?`[${encodeURI(r)}]`:encodeURI(r),u=void 0!==(i=t.port)?`:${i}`:"",l=function(e){if(void 0===e)return"";let t=encodeURIComponent(e.username),s=void 0!==e.password?`:${encodeURIComponent(e.password)}`:"";return`${t}${s}@`}(t.userinfo),h=`//${l}${a}${u}`,c=s.split("/").map(encodeURIComponent).join("/");return""===c||c.startsWith("/")||(c="/"+c),new URL(`${n}${h}${c}`)}var h=s(7536).Buffer;let c="function"==typeof h,f="function"==typeof TextDecoder?new TextDecoder:void 0,d="function"==typeof TextEncoder?new TextEncoder:void 0,p=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),y=(e=>{let t={};return e.forEach((e,s)=>t[e]=s),t})(p),m=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,g=String.fromCharCode.bind(String),w="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),b=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),v=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),_="function"==typeof btoa?e=>btoa(e):c?e=>h.from(e,"binary").toString("base64"):e=>{let t,s,r,i,o="",n=e.length%3;for(let n=0;n<e.length;){if((s=e.charCodeAt(n++))>255||(r=e.charCodeAt(n++))>255||(i=e.charCodeAt(n++))>255)throw TypeError("invalid character found");o+=p[(t=s<<16|r<<8|i)>>18&63]+p[t>>12&63]+p[t>>6&63]+p[63&t]}return n?o.slice(0,n-3)+"===".substring(n):o},q=c?e=>h.from(e).toString("base64"):e=>{let t=[];for(let s=0,r=e.length;s<r;s+=4096)t.push(g.apply(null,e.subarray(s,s+4096)));return _(t.join(""))},S=(e,t=!1)=>t?b(q(e)):q(e),I=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?g(192|t>>>6)+g(128|63&t):g(224|t>>>12&15)+g(128|t>>>6&63)+g(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return g(240|t>>>18&7)+g(128|t>>>12&63)+g(128|t>>>6&63)+g(128|63&t)},C=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,A=c?e=>h.from(e,"utf8").toString("base64"):d?e=>q(d.encode(e)):e=>_(e.replace(C,I)),R=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,k=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return g((t>>>10)+55296)+g((1023&t)+56320);case 3:return g((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return g((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},E="function"==typeof atob?e=>atob(v(e)):c?e=>h.from(e,"base64").toString("binary"):e=>{let t,s,r;if(e=e.replace(/\s+/g,""),!m.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let i=[];for(let o=0;o<e.length;)t=y[e.charAt(o++)]<<18|y[e.charAt(o++)]<<12|(s=y[e.charAt(o++)])<<6|(r=y[e.charAt(o++)]),64===s?i.push(g(t>>16&255)):64===r?i.push(g(t>>16&255,t>>8&255)):i.push(g(t>>16&255,t>>8&255,255&t));return i.join("")},x=c?e=>w(h.from(e,"base64")):e=>w(E(e).split("").map(e=>e.charCodeAt(0))),T=e=>x(O(e)),U=c?e=>h.from(e,"base64").toString("utf8"):f?e=>f.decode(x(e)):e=>E(e).replace(R,k),O=e=>v(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),L={fromUint8Array:S,toUint8Array:T},P="https://github.com/libsql/libsql-client-ts#supported-urls";function B(e){if("write"===e)return"BEGIN IMMEDIATE";if("read"===e)return"BEGIN TRANSACTION READONLY";if("deferred"===e)return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class N{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,t,s,r,i){this.columns=e,this.columnTypes=t,this.rows=s,this.rowsAffected=r,this.lastInsertRowid=i}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(M),rowsAffected:this.rowsAffected,lastInsertRowid:void 0!==this.lastInsertRowid?""+this.lastInsertRowid:null}}}function M(e){return Array.prototype.map.call(e,j)}function j(e){return"bigint"==typeof e?""+e:e instanceof ArrayBuffer?L.fromUint8Array(new Uint8Array(e)):e}let $=":memory:";"undefined"!=typeof WebSocket?r=WebSocket:"undefined"!=typeof global?r=global.WebSocket:"undefined"!=typeof window?r=window.WebSocket:"undefined"!=typeof self&&(r=self.WebSocket);class D{constructor(){this.intMode="number"}intMode}class V extends Error{constructor(e){super(e),this.name="ClientError"}}class F extends V{constructor(e){super(e),this.name="ProtoError"}}class Q extends V{code;proto;constructor(e,t){super(e),this.name="ResponseError",this.code=t.code,this.proto=t,this.stack=void 0}}class z extends V{constructor(e,t){void 0!==t?(super(`${e}: ${t}`),this.cause=t):super(e),this.name="ClosedError"}}class W extends V{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}class H extends V{constructor(e){super(e),this.name="WebSocketError"}}class J extends V{status;constructor(e,t){super(e),this.status=t,this.name="HttpServerError"}}class Y extends V{constructor(e){super(e),this.name="ProtocolVersionError"}}class G extends V{constructor(e){super(e),this.name="InternalError"}}class K extends V{constructor(e){super(e),this.name="MisuseError"}}function Z(e){if("string"==typeof e)return e;throw eo(e,"string")}function X(e){if(null!=e){if("string"==typeof e)return e;throw eo(e,"string or null")}}function ee(e){if("number"==typeof e)return e;throw eo(e,"number")}function et(e){if("boolean"==typeof e)return e;throw eo(e,"boolean")}function es(e){if(Array.isArray(e))return e;throw eo(e,"array")}function er(e){if(null!==e&&"object"==typeof e&&!Array.isArray(e))return e;throw eo(e,"object")}function ei(e,t){return es(e).map(e=>t(er(e)))}function eo(e,t){if(void 0===e)return new F(`Expected ${t}, but the property was missing`);let s=typeof e;return null===e?s="null":Array.isArray(e)&&(s="array"),new F(`Expected ${t}, received ${s}`)}class en{#e;#t;constructor(e){this.#e=e,this.#t=!1}begin(){this.#e.push("{"),this.#t=!0}end(){this.#e.push("}"),this.#t=!1}#s(e){this.#t?(this.#e.push('"'),this.#t=!1):this.#e.push(',"'),this.#e.push(e),this.#e.push('":')}string(e,t){this.#s(e),this.#e.push(JSON.stringify(t))}stringRaw(e,t){this.#s(e),this.#e.push('"'),this.#e.push(t),this.#e.push('"')}number(e,t){this.#s(e),this.#e.push(""+t)}boolean(e,t){this.#s(e),this.#e.push(t?"true":"false")}object(e,t,s){this.#s(e),this.begin(),s(this,t),this.end()}arrayObjects(e,t,s){this.#s(e),this.#e.push("[");for(let e=0;e<t.length;++e)0!==e&&this.#e.push(","),this.begin(),s(this,t[e]),this.end();this.#e.push("]")}}function ea(e,t){let s=[],r=new en(s);return r.begin(),t(r,e),r.end(),s.join("")}class eu{#r;#i;#o;constructor(e){this.#r=e,this.#i=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#o=0}varint(){let e=0;for(let t=0;;t+=7){let s=this.#r[this.#o++];if(e|=(127&s)<<t,!(128&s))break}return e}varintBig(){let e=0n;for(let t=0n;;t+=7n){let s=this.#r[this.#o++];if(e|=BigInt(127&s)<<t,!(128&s))break}return e}bytes(e){let t=new Uint8Array(this.#r.buffer,this.#r.byteOffset+this.#o,e);return this.#o+=e,t}double(){let e=this.#i.getFloat64(this.#o,!0);return this.#o+=8,e}skipVarint(){for(;128&this.#r[this.#o++];);}skip(e){this.#o+=e}eof(){return this.#o>=this.#r.byteLength}}class el{#n;#a;constructor(e){this.#n=e,this.#a=-1}setup(e){this.#a=e}#u(e){if(this.#a!==e)throw new F(`Expected wire type ${e}, got ${this.#a}`);this.#a=-1}bytes(){this.#u(2);let e=this.#n.varint();return this.#n.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return eh(this.bytes(),e)}int32(){return this.#u(0),this.#n.varint()}uint32(){return this.int32()}bool(){return 0!==this.int32()}uint64(){return this.#u(0),this.#n.varintBig()}sint64(){let e=this.uint64();return e>>1n^-(1n&e)}double(){return this.#u(1),this.#n.double()}maybeSkip(){if(!(this.#a<0)){if(0===this.#a)this.#n.skipVarint();else if(1===this.#a)this.#n.skip(8);else if(2===this.#a){let e=this.#n.varint();this.#n.skip(e)}else if(5===this.#a)this.#n.skip(4);else throw new F(`Unexpected wire type ${this.#a}`);this.#a=-1}}}function eh(e,t){let s=new eu(e),r=new el(s),i=t.default();for(;!s.eof();){let e=s.varint(),o=e>>3,n=7&e;r.setup(n);let a=t[o];if(void 0!==a){let e=a(r,i);void 0!==e&&(i=e)}r.maybeSkip()}return i}class ec{#l;#r;#i;#o;constructor(){this.#l=new ArrayBuffer(256),this.#r=new Uint8Array(this.#l),this.#i=new DataView(this.#l),this.#o=0}#h(e){if(this.#o+e<=this.#l.byteLength)return;let t=this.#l.byteLength;for(;t<this.#o+e;)t*=2;let s=new ArrayBuffer(t),r=new Uint8Array(s),i=new DataView(s);r.set(new Uint8Array(this.#l,0,this.#o)),this.#l=s,this.#r=r,this.#i=i}#c(e){this.#h(5),e|=0;do{let t=127&e;e>>>=7,t|=128*!!e,this.#r[this.#o++]=t}while(e)}#f(e){this.#h(10),e&=0xffffffffffffffffn;do{let t=Number(127n&e);e>>=7n,t|=128*!!e,this.#r[this.#o++]=t}while(e)}#d(e,t){this.#c(e<<3|t)}bytes(e,t){this.#d(e,2),this.#c(t.byteLength),this.#h(t.byteLength),this.#r.set(t,this.#o),this.#o+=t.byteLength}string(e,t){this.bytes(e,new TextEncoder().encode(t))}message(e,t,s){let r=new ec;s(r,t),this.bytes(e,r.data())}int32(e,t){this.#d(e,0),this.#c(t)}uint32(e,t){this.int32(e,t)}bool(e,t){this.int32(e,+!!t)}sint64(e,t){this.#d(e,0),this.#f(t<<1n^t>>63n)}double(e,t){this.#d(e,1),this.#h(8),this.#i.setFloat64(this.#o,t,!0),this.#o+=8}data(){return new Uint8Array(this.#l,0,this.#o)}}function ef(e,t){let s=new ec;return t(s,e),s.data()}class ed{#p;#y;constructor(){this.#p=new Set,this.#y=new Set}alloc(){for(let e of this.#y)return this.#y.delete(e),this.#p.add(e),this.#p.has(this.#p.size-1)||this.#y.add(this.#p.size-1),e;let e=this.#p.size;return this.#p.add(e),e}free(e){if(!this.#p.delete(e))throw new G("Freeing an id that is not allocated");this.#y.delete(this.#p.size),e<this.#p.size&&this.#y.add(e)}}function ep(e,t){throw new G(t)}function ey(e){if(null===e)return null;if("string"==typeof e)return e;if("number"==typeof e){if(!Number.isFinite(e))throw RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return e}if("bigint"==typeof e){if(e<em||e>eg)throw RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return e}if("boolean"==typeof e)return e?1n:0n;else if(e instanceof ArrayBuffer)return new Uint8Array(e);else if(e instanceof Uint8Array)return e;else if(e instanceof Date)return+e.valueOf();else if("object"==typeof e)return""+e.toString();else throw TypeError("Unsupported type of value")}let em=-0x8000000000000000n,eg=0x7fffffffffffffffn;function ew(e,t){if(null===e)return null;if("number"==typeof e)return e;if("string"==typeof e)return e;if("bigint"==typeof e)if("number"===t){let t=Number(e);if(!Number.isSafeInteger(t))throw RangeError("Received integer which is too large to be safely represented as a JavaScript number");return t}else if("bigint"===t)return e;else if("string"===t)return""+e;else throw new K("Invalid value for IntMode");if(e instanceof Uint8Array)return e.slice().buffer;else if(void 0===e)throw new F("Received unrecognized type of Value");else throw ep(e,"Impossible type of Value")}function eb(e){return{affectedRowCount:e.affectedRowCount,lastInsertRowid:e.lastInsertRowid,columnNames:e.cols.map(e=>e.name),columnDecltypes:e.cols.map(e=>e.decltype)}}function ev(e,t){let s=eb(e),r=e.rows.map(e=>eS(s.columnNames,e,t));return{...s,rows:r}}function e_(e,t){let s,r=eb(e);return e.rows.length>0&&(s=eS(r.columnNames,e.rows[0],t)),{...r,row:s}}function eq(e,t){let s,r=eb(e);return e.rows.length>0&&r.columnNames.length>0&&(s=ew(e.rows[0][0],t)),{...r,value:s}}function eS(e,t,s){let r={};Object.defineProperty(r,"length",{value:t.length});for(let i=0;i<t.length;++i){let o=ew(t[i],s);Object.defineProperty(r,i,{value:o});let n=e[i];void 0===n||Object.hasOwn(r,n)||Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0})}return r}function eI(e){return new Q(e.message,e)}class eC{#m;#g;#w;constructor(e,t){this.#m=e,this.#g=t,this.#w=void 0}_getSqlId(e){if(this.#m!==e)throw new K("Attempted to use SQL text opened with other object");if(void 0!==this.#w)throw new z("SQL text is closed",this.#w);return this.#g}close(){this._setClosed(new V("SQL text was manually closed"))}_setClosed(e){void 0===this.#w&&(this.#w=e,this.#m._closeSql(this.#g))}get closed(){return void 0!==this.#w}}function eA(e,t){return t instanceof eC?{sqlId:t._getSqlId(e)}:{sql:""+t}}class eR{#b;#v;constructor(){this.#b=[],this.#v=[]}get length(){return this.#b.length+this.#v.length}push(e){this.#b.push(e)}shift(){return 0===this.#v.length&&this.#b.length>0&&(this.#v=this.#b.reverse(),this.#b=[]),this.#v.pop()}first(){return 0!==this.#v.length?this.#v[this.#v.length-1]:this.#b[0]}}class ek{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){for(let t of(this._args.length=0,e))this._args.push(ey(t));return this}bindIndex(e,t){if(e!==(0|e)||e<=0)throw RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=ey(t),this}bindName(e,t){return this._namedArgs.set(e,ey(t)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}}function eE(e,t,s){let r,i=[],o=[];if(t instanceof ek)for(let[e,s]of(r=t.sql,i=t._args,t._namedArgs.entries()))o.push({name:e,value:s});else Array.isArray(t)?(r=t[0],Array.isArray(t[1])?i=t[1].map(e=>ey(e)):o=Object.entries(t[1]).map(([e,t])=>({name:e,value:ey(t)}))):r=t;let{sql:n,sqlId:a}=eA(e,r);return{sql:n,sqlId:a,args:i,namedArgs:o,wantRows:s}}class ex{_stream;#_;_steps;#q;constructor(e,t){this._stream=e,this.#_=t,this._steps=[],this.#q=!1}step(){return new eU(this)}execute(){var e,t,s;if(this.#q)throw new K("This batch has already been executed");this.#q=!0;let r={steps:this._steps.map(e=>e.proto)};return this.#_?eT(this._stream,this._steps,r):(e=this._stream,t=this._steps,s=r,e._batch(s).then(e=>{for(let s=0;s<t.length;++s){let r=e.stepResults.get(s),i=e.stepErrors.get(s);t[s].callback(r,i)}}))}}async function eT(e,t,s){let r=await e._openCursor(s);try{let e,s=0,i=[];for(;;){let o=await r.next();if(void 0===o)break;if("step_begin"===o.type){if(o.step<s||o.step>=t.length)throw new F("Server produced StepBeginEntry for unexpected step");if(void 0!==e)throw new F("Server produced StepBeginEntry before terminating previous step");for(let e=s;e<o.step;++e)t[e].callback(void 0,void 0);s=o.step+1,e=o,i=[]}else if("step_end"===o.type){if(void 0===e)throw new F("Server produced StepEndEntry but no step is active");let s={cols:e.cols,rows:i,affectedRowCount:o.affectedRowCount,lastInsertRowid:o.lastInsertRowid};t[e.step].callback(s,void 0),e=void 0,i=[]}else if("step_error"===o.type){if(void 0===e){if(o.step>=t.length)throw new F("Server produced StepErrorEntry for unexpected step");for(let e=s;e<o.step;++e)t[e].callback(void 0,void 0)}else{if(o.step!==e.step)throw new F("Server produced StepErrorEntry for unexpected step");e=void 0,i=[]}t[o.step].callback(void 0,o.error),s=o.step+1}else if("row"===o.type){if(void 0===e)throw new F("Server produced RowEntry but no step is active");i.push(o.row)}else if("error"===o.type)throw eI(o.error);else if("none"===o.type)throw new F("Server produced unrecognized CursorEntry");else throw ep(o,"Impossible CursorEntry")}if(void 0!==e)throw new F("Server closed Cursor before terminating active step");for(let e=s;e<t.length;++e)t[e].callback(void 0,void 0)}finally{r.close()}}class eU{_batch;#S;_index;constructor(e){this._batch=e,this.#S=[],this._index=void 0}condition(e){return this.#S.push(e._proto),this}query(e){return this.#I(e,!0,ev)}queryRow(e){return this.#I(e,!0,e_)}queryValue(e){return this.#I(e,!0,eq)}run(e){return this.#I(e,!1,eb)}#I(e,t,s){if(void 0!==this._index)throw new K("This BatchStep has already been added to the batch");let r={stmt:eE(this._batch._stream._sqlOwner(),e,t),condition:0===this.#S.length?void 0:1===this.#S.length?this.#S[0]:{type:"and",conds:this.#S.slice()}};return new Promise((e,t)=>{this._index=this._batch._steps.length,this._batch._steps.push({proto:r,callback:(r,i)=>{void 0!==r&&void 0!==i?t(new F("Server returned both result and error")):void 0!==i?t(eI(i)):void 0!==r?e(s(r,this._batch._stream.intMode)):e(void 0)}})})}}class eO{_batch;_proto;constructor(e,t){this._batch=e,this._proto=t}static ok(e){return new eO(e._batch,{type:"ok",step:eL(e)})}static error(e){return new eO(e._batch,{type:"error",step:eL(e)})}static not(e){return new eO(e._batch,{type:"not",cond:e._proto})}static and(e,t){for(let s of t)eP(e,s);return new eO(e,{type:"and",conds:t.map(e=>e._proto)})}static or(e,t){for(let s of t)eP(e,s);return new eO(e,{type:"or",conds:t.map(e=>e._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new eO(e,{type:"is_autocommit"})}}function eL(e){if(void 0===e._index)throw new K("Cannot add a condition referencing a step that has not been added to the batch");return e._index}function eP(e,t){if(t._batch!==e)throw new K("Cannot mix BatchCond objects for different Batch objects")}function eB(e){return{paramNames:e.params.map(e=>e.name),columns:e.cols,isExplain:e.isExplain,isReadonly:e.isReadonly}}class eN{constructor(e){this.intMode=e}query(e){return this.#C(e,!0,ev)}queryRow(e){return this.#C(e,!0,e_)}queryValue(e){return this.#C(e,!0,eq)}run(e){return this.#C(e,!1,eb)}#C(e,t,s){let r=eE(this._sqlOwner(),e,t);return this._execute(r).then(e=>s(e,this.intMode))}batch(e=!1){return new ex(this,e)}describe(e){let t=eA(this._sqlOwner(),e);return this._describe(t).then(eB)}sequence(e){let t=eA(this._sqlOwner(),e);return this._sequence(t)}intMode}class eM{}class ej extends eM{#A;#R;#k;#E;#x;#w;#T;constructor(e,t,s){super(),this.#A=e,this.#R=t,this.#k=s,this.#E=new eR,this.#x=new eR,this.#w=void 0,this.#T=!1}async next(){for(;;){if(void 0!==this.#w)throw new z("Cursor is closed",this.#w);for(;!this.#T&&this.#x.length<10;)this.#x.push(this.#U());let e=this.#E.shift();if(this.#T||void 0!==e)return e;await this.#x.shift().then(e=>{if(void 0!==e){for(let t of e.entries)this.#E.push(t);this.#T||=e.done}})}}#U(){return this.#R._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#k,maxCount:1e3}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){void 0===this.#w&&(this.#w=e,this.#R._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#k}).catch(()=>void 0),this.#R._cursorClosed(this))}close(){this._setClosed(new V("Cursor was manually closed"))}get closed(){return void 0!==this.#w}}class e$ extends eN{#A;#O;#L;#P;#B;#w;static open(e){let t=e._streamIdAlloc.alloc(),s=new e$(e,t);return e._sendRequest({type:"open_stream",streamId:t},{responseCallback:()=>void 0,errorCallback:e=>s.#N(e)}),s}constructor(e,t){super(e.intMode),this.#A=e,this.#O=t,this.#L=new eR,this.#P=void 0,this.#B=!1,this.#w=void 0}client(){return this.#A}_sqlOwner(){return this.#A}_execute(e){return this.#M({type:"execute",streamId:this.#O,stmt:e}).then(e=>e.result)}_batch(e){return this.#M({type:"batch",streamId:this.#O,batch:e}).then(e=>e.result)}_describe(e){return this.#A._ensureVersion(2,"describe()"),this.#M({type:"describe",streamId:this.#O,sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#A._ensureVersion(2,"sequence()"),this.#M({type:"sequence",streamId:this.#O,sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#M({type:"get_autocommit",streamId:this.#O}).then(e=>e.isAutocommit)}#M(e){return new Promise((t,s)=>{this.#j({type:"request",request:e,responseCallback:t,errorCallback:s})})}_openCursor(e){return this.#A._ensureVersion(3,"cursor"),new Promise((t,s)=>{this.#j({type:"cursor",batch:e,cursorCallback:t,errorCallback:s})})}_sendCursorRequest(e,t){if(e!==this.#P)throw new G("Cursor not associated with the stream attempted to execute a request");return new Promise((e,s)=>{void 0!==this.#w?s(new z("Stream is closed",this.#w)):this.#A._sendRequest(t,{responseCallback:e,errorCallback:s})})}_cursorClosed(e){if(e!==this.#P)throw new G("Cursor was closed, but it was not associated with the stream");this.#P=void 0,this.#$()}#j(e){void 0!==this.#w?e.errorCallback(new z("Stream is closed",this.#w)):this.#B?e.errorCallback(new z("Stream is closing",void 0)):(this.#L.push(e),this.#$())}#$(){for(;;){let e=this.#L.first();if(void 0===e&&void 0===this.#P&&this.#B){this.#N(new V("Stream was gracefully closed"));break}if(e?.type==="request"&&void 0===this.#P){let{request:t,responseCallback:s,errorCallback:r}=e;this.#L.shift(),this.#A._sendRequest(t,{responseCallback:s,errorCallback:r})}else if(e?.type==="cursor"&&void 0===this.#P){let{batch:t,cursorCallback:s}=e;this.#L.shift();let r=this.#A._cursorIdAlloc.alloc(),i=new ej(this.#A,this,r),o={type:"open_cursor",streamId:this.#O,cursorId:r,batch:t},n=()=>void 0,a=e=>i._setClosed(e);this.#A._sendRequest(o,{responseCallback:n,errorCallback:a}),this.#P=i,s(i)}else break}}#N(e){if(void 0!==this.#w)return;for(this.#w=e,void 0!==this.#P&&this.#P._setClosed(e);;){let t=this.#L.shift();if(void 0!==t)t.errorCallback(e);else break}let t={type:"close_stream",streamId:this.#O};this.#A._sendRequest(t,{responseCallback:()=>this.#A._streamIdAlloc.free(this.#O),errorCallback:()=>void 0})}close(){this.#N(new V("Stream was manually closed"))}closeGracefully(){this.#B=!0,this.#$()}get closed(){return void 0!==this.#w||this.#B}}function eD(e,t){void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId),e.arrayObjects("args",t.args,eW),e.arrayObjects("named_args",t.namedArgs,eV),e.boolean("want_rows",t.wantRows)}function eV(e,t){e.string("name",t.name),e.object("value",t.value,eW)}function eF(e,t){e.arrayObjects("steps",t.steps,eQ)}function eQ(e,t){void 0!==t.condition&&e.object("condition",t.condition,ez),e.object("stmt",t.stmt,eD)}function ez(e,t){if(e.stringRaw("type",t.type),"ok"===t.type||"error"===t.type)e.number("step",t.step);else if("not"===t.type)e.object("cond",t.cond,ez);else if("and"===t.type||"or"===t.type)e.arrayObjects("conds",t.conds,ez);else if("is_autocommit"===t.type);else throw ep(t,"Impossible type of BatchCond")}function eW(e,t){if(null===t)e.stringRaw("type","null");else if("bigint"==typeof t)e.stringRaw("type","integer"),e.stringRaw("value",""+t);else if("number"==typeof t)e.stringRaw("type","float"),e.number("value",t);else if("string"==typeof t)e.stringRaw("type","text"),e.string("value",t);else if(t instanceof Uint8Array)e.stringRaw("type","blob"),e.stringRaw("base64",L.fromUint8Array(t));else if(void 0===t);else throw ep(t,"Impossible type of Value")}function eH(e,t){if(e.stringRaw("type",t.type),"hello"===t.type)void 0!==t.jwt&&e.string("jwt",t.jwt);else if("request"===t.type)e.number("request_id",t.requestId),e.object("request",t.request,eJ);else throw ep(t,"Impossible type of ClientMsg")}function eJ(e,t){if(e.stringRaw("type",t.type),"open_stream"===t.type)e.number("stream_id",t.streamId);else if("close_stream"===t.type)e.number("stream_id",t.streamId);else if("execute"===t.type)e.number("stream_id",t.streamId),e.object("stmt",t.stmt,eD);else if("batch"===t.type)e.number("stream_id",t.streamId),e.object("batch",t.batch,eF);else if("open_cursor"===t.type)e.number("stream_id",t.streamId),e.number("cursor_id",t.cursorId),e.object("batch",t.batch,eF);else if("close_cursor"===t.type)e.number("cursor_id",t.cursorId);else if("fetch_cursor"===t.type)e.number("cursor_id",t.cursorId),e.number("max_count",t.maxCount);else if("sequence"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)e.number("stream_id",t.streamId),void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type)e.number("stream_id",t.streamId);else throw ep(t,"Impossible type of Request")}function eY(e,t){for(let s of(void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId),t.args))e.message(3,s,e1);for(let s of t.namedArgs)e.message(4,s,eG);e.bool(5,t.wantRows)}function eG(e,t){e.string(1,t.name),e.message(2,t.value,e1)}function eK(e,t){for(let s of t.steps)e.message(1,s,eZ)}function eZ(e,t){void 0!==t.condition&&e.message(1,t.condition,eX),e.message(2,t.stmt,eY)}function eX(e,t){if("ok"===t.type)e.uint32(1,t.step);else if("error"===t.type)e.uint32(2,t.step);else if("not"===t.type)e.message(3,t.cond,eX);else if("and"===t.type)e.message(4,t.conds,e0);else if("or"===t.type)e.message(5,t.conds,e0);else if("is_autocommit"===t.type)e.message(6,void 0,e2);else throw ep(t,"Impossible type of BatchCond")}function e0(e,t){for(let s of t)e.message(1,s,eX)}function e1(e,t){if(null===t)e.message(1,void 0,e2);else if("bigint"==typeof t)e.sint64(2,t);else if("number"==typeof t)e.double(3,t);else if("string"==typeof t)e.string(4,t);else if(t instanceof Uint8Array)e.bytes(5,t);else if(void 0===t);else throw ep(t,"Impossible type of Value")}function e2(e,t){}function e3(e,t){if("hello"===t.type)e.message(1,t,e6);else if("request"===t.type)e.message(2,t,e8);else throw ep(t,"Impossible type of ClientMsg")}function e6(e,t){void 0!==t.jwt&&e.string(1,t.jwt)}function e8(e,t){e.int32(1,t.requestId);let s=t.request;if("open_stream"===s.type)e.message(2,s,e5);else if("close_stream"===s.type)e.message(3,s,e4);else if("execute"===s.type)e.message(4,s,e7);else if("batch"===s.type)e.message(5,s,e9);else if("open_cursor"===s.type)e.message(6,s,te);else if("close_cursor"===s.type)e.message(7,s,tt);else if("fetch_cursor"===s.type)e.message(8,s,ts);else if("sequence"===s.type)e.message(9,s,tr);else if("describe"===s.type)e.message(10,s,ti);else if("store_sql"===s.type)e.message(11,s,to);else if("close_sql"===s.type)e.message(12,s,tn);else if("get_autocommit"===s.type)e.message(13,s,ta);else throw ep(s,"Impossible type of Request")}function e5(e,t){e.int32(1,t.streamId)}function e4(e,t){e.int32(1,t.streamId)}function e7(e,t){e.int32(1,t.streamId),e.message(2,t.stmt,eY)}function e9(e,t){e.int32(1,t.streamId),e.message(2,t.batch,eK)}function te(e,t){e.int32(1,t.streamId),e.int32(2,t.cursorId),e.message(3,t.batch,eK)}function tt(e,t){e.int32(1,t.cursorId)}function ts(e,t){e.int32(1,t.cursorId),e.uint32(2,t.maxCount)}function tr(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function ti(e,t){e.int32(1,t.streamId),void 0!==t.sql&&e.string(2,t.sql),void 0!==t.sqlId&&e.int32(3,t.sqlId)}function to(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function tn(e,t){e.int32(1,t.sqlId)}function ta(e,t){e.int32(1,t.streamId)}function tu(e){return{message:Z(e.message),code:X(e.code)}}function tl(e){let t=ei(e.cols,th),s=es(e.rows).map(e=>ei(e,tm)),r=ee(e.affected_row_count),i=X(e.last_insert_rowid);return{cols:t,rows:s,affectedRowCount:r,lastInsertRowid:void 0!==i?BigInt(i):void 0}}function th(e){return{name:X(e.name),decltype:X(e.decltype)}}function tc(e){let t=new Map;es(e.step_results).forEach((e,s)=>{null!==e&&t.set(s,tl(er(e)))});let s=new Map;return es(e.step_errors).forEach((e,t)=>{null!==e&&s.set(t,tu(er(e)))}),{stepResults:t,stepErrors:s}}function tf(e){let t=Z(e.type);if("step_begin"===t)return{type:"step_begin",step:ee(e.step),cols:ei(e.cols,th)};if("step_end"===t){let t=ee(e.affected_row_count),s=X(e.last_insert_rowid);return{type:"step_end",affectedRowCount:t,lastInsertRowid:void 0!==s?BigInt(s):void 0}}if("step_error"===t)return{type:"step_error",step:ee(e.step),error:tu(er(e.error))};if("row"===t)return{type:"row",row:ei(e.row,tm)};if("error"===t)return{type:"error",error:tu(er(e.error))};else throw new F("Unexpected type of CursorEntry")}function td(e){let t=ei(e.params,tp),s=ei(e.cols,ty);return{params:t,cols:s,isExplain:et(e.is_explain),isReadonly:et(e.is_readonly)}}function tp(e){return{name:X(e.name)}}function ty(e){return{name:Z(e.name),decltype:X(e.decltype)}}function tm(e){let t=Z(e.type);if("null"===t)return null;if("integer"===t)return BigInt(Z(e.value));if("float"===t)return ee(e.value);if("text"===t)return Z(e.value);if("blob"===t)return L.toUint8Array(Z(e.base64));else throw new F("Unexpected type of Value")}let tg={default:()=>({message:"",code:void 0}),1(e,t){t.message=e.string()},2(e,t){t.code=e.string()}},tw={default:()=>({cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.cols.push(e.message(tb))},2(e,t){t.rows.push(e.message(tv))},3(e,t){t.affectedRowCount=Number(e.uint64())},4(e,t){t.lastInsertRowid=e.sint64()}},tb={default:()=>({name:void 0,decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},tv={default:()=>[],1(e,t){t.push(e.message(tT))}},t_={default:()=>({stepResults:new Map,stepErrors:new Map}),1(e,t){let[s,r]=e.message(tq);t.stepResults.set(s,r)},2(e,t){let[s,r]=e.message(tS);t.stepErrors.set(s,r)}},tq={default:()=>[0,tw.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(tw)}},tS={default:()=>[0,tg.default()],1(e,t){t[0]=e.uint32()},2(e,t){t[1]=e.message(tg)}},tI={default:()=>({type:"none"}),1:e=>e.message(tC),2:e=>e.message(tA),3:e=>e.message(tR),4:e=>({type:"row",row:e.message(tv)}),5:e=>({type:"error",error:e.message(tg)})},tC={default:()=>({type:"step_begin",step:0,cols:[]}),1(e,t){t.step=e.uint32()},2(e,t){t.cols.push(e.message(tb))}},tA={default:()=>({type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}),1(e,t){t.affectedRowCount=e.uint32()},2(e,t){t.lastInsertRowid=e.uint64()}},tR={default:()=>({type:"step_error",step:0,error:tg.default()}),1(e,t){t.step=e.uint32()},2(e,t){t.error=e.message(tg)}},tk={default:()=>({params:[],cols:[],isExplain:!1,isReadonly:!1}),1(e,t){t.params.push(e.message(tE))},2(e,t){t.cols.push(e.message(tx))},3(e,t){t.isExplain=e.bool()},4(e,t){t.isReadonly=e.bool()}},tE={default:()=>({name:void 0}),1(e,t){t.name=e.string()}},tx={default:()=>({name:"",decltype:void 0}),1(e,t){t.name=e.string()},2(e,t){t.decltype=e.string()}},tT={default(){},1:e=>null,2:e=>e.sint64(),3:e=>e.double(),4:e=>e.string(),5:e=>e.bytes()},tU={default:()=>({type:"none"}),1:e=>({type:"hello_ok"}),2:e=>e.message(tO),3:e=>e.message(tP),4:e=>e.message(tL)},tO={default:()=>({type:"hello_error",error:tg.default()}),1(e,t){t.error=e.message(tg)}},tL={default:()=>({type:"response_error",requestId:0,error:tg.default()}),1(e,t){t.requestId=e.int32()},2(e,t){t.error=e.message(tg)}},tP={default:()=>({type:"response_ok",requestId:0,response:{type:"none"}}),1(e,t){t.requestId=e.int32()},2(e,t){t.response={type:"open_stream"}},3(e,t){t.response={type:"close_stream"}},4(e,t){t.response=e.message(tB)},5(e,t){t.response=e.message(tN)},6(e,t){t.response={type:"open_cursor"}},7(e,t){t.response={type:"close_cursor"}},8(e,t){t.response=e.message(tM)},9(e,t){t.response={type:"sequence"}},10(e,t){t.response=e.message(tj)},11(e,t){t.response={type:"store_sql"}},12(e,t){t.response={type:"close_sql"}},13(e,t){t.response=e.message(t$)}},tB={default:()=>({type:"execute",result:tw.default()}),1(e,t){t.result=e.message(tw)}},tN={default:()=>({type:"batch",result:t_.default()}),1(e,t){t.result=e.message(t_)}},tM={default:()=>({type:"fetch_cursor",entries:[],done:!1}),1(e,t){t.entries.push(e.message(tI))},2(e,t){t.done=e.bool()}},tj={default:()=>({type:"describe",result:tk.default()}),1(e,t){t.result=e.message(tk)}},t$={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}},tD=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),tV=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);class tF extends D{#D;#V;#F;#w;#Q;#z;#W;#H;#J;_streamIdAlloc;_cursorIdAlloc;#Y;constructor(e,t){super(),this.#D=e,this.#V=[],this.#F=!1,this.#w=void 0,this.#Q=!1,this.#z=void 0,this.#W=!1,this.#H=new Map,this.#J=new ed,this._streamIdAlloc=new ed,this._cursorIdAlloc=new ed,this.#Y=new ed,this.#D.binaryType="arraybuffer",this.#D.addEventListener("open",()=>this.#G()),this.#D.addEventListener("close",e=>this.#K(e)),this.#D.addEventListener("error",e=>this.#Z(e)),this.#D.addEventListener("message",e=>this.#X(e)),this.#ee({type:"hello",jwt:t})}#ee(e){if(void 0!==this.#w)throw new G("Trying to send a message on a closed client");this.#F?this.#et(e):this.#V.push({openCallback:()=>this.#et(e),errorCallback:()=>void 0})}#G(){let e=this.#D.protocol;if(void 0===e)return void this.#N(new V("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));if(""===e)this.#z={version:1,encoding:"json"};else if(this.#z=tV.get(e),void 0===this.#z)return void this.#N(new F(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));for(let e of this.#V)e.openCallback();this.#V.length=0,this.#F=!0}#et(e){let t=this.#z.encoding;if("json"===t){let t=ea(e,eH);this.#D.send(t)}else if("protobuf"===t){let t=ef(e,e3);this.#D.send(t)}else throw ep(t,"Impossible encoding")}getVersion(){return new Promise((e,t)=>{this.#W=!0,void 0!==this.#w?t(this.#w):this.#F?e(this.#z.version):this.#V.push({openCallback:()=>e(this.#z.version),errorCallback:t})})}_ensureVersion(e,t){if(void 0!==this.#z&&this.#W){if(this.#z.version<e)throw new Y(`${t} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#z.version}`)}else throw new Y(`${t} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`)}_sendRequest(e,t){if(void 0!==this.#w)return void t.errorCallback(new z("Client is closed",this.#w));let s=this.#J.alloc();this.#H.set(s,{...t,type:e.type}),this.#ee({type:"request",requestId:s,request:e})}#Z(e){let t=e.message;this.#N(new H(t??"WebSocket was closed due to an error"))}#K(e){let t=`WebSocket was closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.#N(new H(t))}#N(e){if(void 0===this.#w){for(let t of(this.#w=e,this.#V))t.errorCallback(e);for(let[t,s]of(this.#V.length=0,this.#H.entries()))s.errorCallback(e),this.#J.free(t);this.#H.clear(),this.#D.close()}}#X(e){if(void 0===this.#w)try{let s,r=this.#z.encoding;if("json"===r){var t;if("string"!=typeof e.data){this.#D.close(3003,"Only text messages are accepted with JSON encoding"),this.#N(new F("Received non-text message from server with JSON encoding"));return}t=JSON.parse(e.data),s=function(e){let t=Z(e.type);if("hello_ok"===t)return{type:"hello_ok"};if("hello_error"===t)return{type:"hello_error",error:tu(er(e.error))};if("response_ok"===t)return{type:"response_ok",requestId:ee(e.request_id),response:function(e){let t=Z(e.type);if("open_stream"===t)return{type:"open_stream"};if("close_stream"===t)return{type:"close_stream"};if("execute"===t)return{type:"execute",result:tl(er(e.result))};if("batch"===t)return{type:"batch",result:tc(er(e.result))};if("open_cursor"===t)return{type:"open_cursor"};else if("close_cursor"===t)return{type:"close_cursor"};else if("fetch_cursor"===t)return{type:"fetch_cursor",entries:ei(e.entries,tf),done:et(e.done)};else if("sequence"===t)return{type:"sequence"};else if("describe"===t)return{type:"describe",result:td(er(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:et(e.is_autocommit)};else throw new F("Unexpected type of Response")}(er(e.response))};if("response_error"===t)return{type:"response_error",requestId:ee(e.request_id),error:tu(er(e.error))};throw new F("Unexpected type of ServerMsg")}(er(t))}else if("protobuf"===r){if(!(e.data instanceof ArrayBuffer)){this.#D.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#N(new F("Received non-binary message from server with Protobuf encoding"));return}s=eh(new Uint8Array(e.data),tU)}else throw ep(r,"Impossible encoding");this.#es(s)}catch(e){this.#D.close(3007,"Could not handle message"),this.#N(e)}}#es(e){if("none"===e.type)throw new F("Received an unrecognized ServerMsg");if("hello_ok"===e.type||"hello_error"===e.type){if(this.#Q)throw new F("Received a duplicated hello response");if(this.#Q=!0,"hello_error"===e.type)throw eI(e.error);return}if(!this.#Q)throw new F("Received a non-hello message before a hello response");if("response_ok"===e.type){let t=e.requestId,s=this.#H.get(t);if(this.#H.delete(t),void 0===s)throw new F("Received unexpected OK response");this.#J.free(t);try{if(s.type!==e.response.type)throw console.dir({responseState:s,msg:e}),new F("Received unexpected type of response");s.responseCallback(e.response)}catch(e){throw s.errorCallback(e),e}}else if("response_error"===e.type){let t=e.requestId,s=this.#H.get(t);if(this.#H.delete(t),void 0===s)throw new F("Received unexpected error response");this.#J.free(t),s.errorCallback(eI(e.error))}else throw ep(e,"Impossible ServerMsg type")}openStream(){return e$.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");let t=this.#Y.alloc(),s=new eC(this,t);return this._sendRequest({type:"store_sql",sqlId:t,sql:e},{responseCallback:()=>void 0,errorCallback:e=>s._setClosed(e)}),s}_closeSql(e){void 0===this.#w&&this._sendRequest({type:"close_sql",sqlId:e},{responseCallback:()=>this.#Y.free(e),errorCallback:e=>this.#N(e)})}close(){this.#N(new V("Client was manually closed"))}get closed(){return void 0!==this.#w}}let tQ=fetch,tz=Request,tW=Headers;if("undefined"!=typeof queueMicrotask)i=queueMicrotask;else{let e=Promise.resolve();i=t=>{e.then(t)}}class tH{#r;#er;#ei;constructor(e){this.#r=new Uint8Array(new ArrayBuffer(e)),this.#er=0,this.#ei=0}get length(){return this.#ei-this.#er}data(){return this.#r.slice(this.#er,this.#ei)}push(e){this.#eo(e.byteLength),this.#r.set(e,this.#ei),this.#ei+=e.byteLength}#eo(e){if(this.#ei+e<=this.#r.byteLength)return;let t=this.#ei-this.#er;if(t+e<=this.#r.byteLength&&2*this.#ei>=this.#r.byteLength)this.#r.copyWithin(0,this.#er,this.#ei);else{let s=this.#r.byteLength;do s*=2;while(t+e>s);let r=new Uint8Array(new ArrayBuffer(s));r.set(this.#r.slice(this.#er,this.#ei),0),this.#r=r}this.#ei=t,this.#er=0}shift(e){this.#er+=e}}function tJ(e){let t=Z(e.type);if("ok"===t)return{type:"ok",response:function(e){let t=Z(e.type);if("close"===t)return{type:"close"};if("execute"===t)return{type:"execute",result:tl(er(e.result))};if("batch"===t)return{type:"batch",result:tc(er(e.result))};if("sequence"===t)return{type:"sequence"};if("describe"===t)return{type:"describe",result:td(er(e.result))};else if("store_sql"===t)return{type:"store_sql"};else if("close_sql"===t)return{type:"close_sql"};else if("get_autocommit"===t)return{type:"get_autocommit",isAutocommit:et(e.is_autocommit)};else throw new F("Unexpected type of StreamResponse")}(er(e.response))};if("error"===t)return{type:"error",error:tu(er(e.error))};throw new F("Unexpected type of StreamResult")}function tY(e){return{baton:X(e.baton),baseUrl:X(e.base_url)}}let tG={default:()=>({baton:void 0,baseUrl:void 0,results:[]}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()},3(e,t){t.results.push(e.message(tK))}},tK={default:()=>({type:"none"}),1:e=>({type:"ok",response:e.message(tZ)}),2:e=>({type:"error",error:e.message(tg)})},tZ={default:()=>({type:"none"}),1:e=>({type:"close"}),2:e=>e.message(tX),3:e=>e.message(t0),4:e=>({type:"sequence"}),5:e=>e.message(t1),6:e=>({type:"store_sql"}),7:e=>({type:"close_sql"}),8:e=>e.message(t2)},tX={default:()=>({type:"execute",result:tw.default()}),1(e,t){t.result=e.message(tw)}},t0={default:()=>({type:"batch",result:t_.default()}),1(e,t){t.result=e.message(t_)}},t1={default:()=>({type:"describe",result:tk.default()}),1(e,t){t.result=e.message(tk)}},t2={default:()=>({type:"get_autocommit",isAutocommit:!1}),1(e,t){t.isAutocommit=e.bool()}},t3={default:()=>({baton:void 0,baseUrl:void 0}),1(e,t){t.baton=e.string()},2(e,t){t.baseUrl=e.string()}};class t6 extends eM{#R;#en;#n;#L;#w;#T;constructor(e,t){super(),this.#R=e,this.#en=t,this.#n=void 0,this.#L=new tH(16384),this.#w=void 0,this.#T=!1}async open(e){if(null===e.body)throw new F("No response body for cursor request");this.#n=e.body.getReader();let t=await this.#ea(tY,t3);if(void 0===t)throw new F("Empty response to cursor request");return t}next(){return this.#ea(tf,tI)}close(){this._setClosed(new V("Cursor was manually closed"))}_setClosed(e){void 0===this.#w&&(this.#w=e,this.#R._cursorClosed(this),void 0!==this.#n&&this.#n.cancel())}get closed(){return void 0!==this.#w}async #ea(e,t){for(;;){if(this.#T)return;if(void 0!==this.#w)throw new z("Cursor is closed",this.#w);if("json"===this.#en){let t=this.#eu();if(void 0!==t)return e(er(JSON.parse(new TextDecoder().decode(t))))}else if("protobuf"===this.#en){let e=this.#el();if(void 0!==e)return eh(e,t)}else throw ep(this.#en,"Impossible encoding");if(void 0===this.#n)throw new G("Attempted to read from HTTP cursor before it was opened");let{value:s,done:r}=await this.#n.read();if(r&&0===this.#L.length)this.#T=!0;else if(r)throw new F("Unexpected end of cursor stream");else this.#L.push(s)}}#eu(){let e=this.#L.data(),t=e.indexOf(10);if(t<0)return;let s=e.slice(0,t);return this.#L.shift(t+1),s}#el(){let e=this.#L.data(),t=0,s=0;for(;;){if(s>=e.byteLength)return;let r=e[s];if(t|=(127&r)<<7*s,s+=1,!(128&r))break}if(e.byteLength<s+t)return;let r=e.slice(s,s+t);return this.#L.shift(s+t),r}}function t8(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.arrayObjects("requests",t.requests,t5)}function t5(e,t){if(e.stringRaw("type",t.type),"close"===t.type);else if("execute"===t.type)e.object("stmt",t.stmt,eD);else if("batch"===t.type)e.object("batch",t.batch,eF);else if("sequence"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("describe"===t.type)void 0!==t.sql&&e.string("sql",t.sql),void 0!==t.sqlId&&e.number("sql_id",t.sqlId);else if("store_sql"===t.type)e.number("sql_id",t.sqlId),e.string("sql",t.sql);else if("close_sql"===t.type)e.number("sql_id",t.sqlId);else if("get_autocommit"===t.type);else throw ep(t,"Impossible type of StreamRequest")}function t4(e,t){void 0!==t.baton&&e.string("baton",t.baton),e.object("batch",t.batch,eF)}function t7(e,t){for(let s of(void 0!==t.baton&&e.string(1,t.baton),t.requests))e.message(2,s,t9)}function t9(e,t){if("close"===t.type)e.message(1,t,se);else if("execute"===t.type)e.message(2,t,st);else if("batch"===t.type)e.message(3,t,ss);else if("sequence"===t.type)e.message(4,t,sr);else if("describe"===t.type)e.message(5,t,si);else if("store_sql"===t.type)e.message(6,t,so);else if("close_sql"===t.type)e.message(7,t,sn);else if("get_autocommit"===t.type)e.message(8,t,sa);else throw ep(t,"Impossible type of StreamRequest")}function se(e,t){}function st(e,t){e.message(1,t.stmt,eY)}function ss(e,t){e.message(1,t.batch,eK)}function sr(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function si(e,t){void 0!==t.sql&&e.string(1,t.sql),void 0!==t.sqlId&&e.int32(2,t.sqlId)}function so(e,t){e.int32(1,t.sqlId),e.string(2,t.sql)}function sn(e,t){e.int32(1,t.sqlId)}function sa(e,t){}function su(e,t){void 0!==t.baton&&e.string(1,t.baton),e.message(2,t.batch,eK)}class sl extends eN{#A;#eh;#ec;#U;#ef;#L;#ed;#P;#B;#ep;#w;#Y;constructor(e,t,s,r){super(e.intMode),this.#A=e,this.#eh=t.toString(),this.#ec=s,this.#U=r,this.#ef=void 0,this.#L=new eR,this.#ed=!1,this.#B=!1,this.#ep=!1,this.#w=void 0,this.#Y=new ed}client(){return this.#A}_sqlOwner(){return this}storeSql(e){let t=this.#Y.alloc();return this.#M({type:"store_sql",sqlId:t,sql:e}).then(()=>void 0,e=>this._setClosed(e)),new eC(this,t)}_closeSql(e){void 0===this.#w&&this.#M({type:"close_sql",sqlId:e}).then(()=>this.#Y.free(e),e=>this._setClosed(e))}_execute(e){return this.#M({type:"execute",stmt:e}).then(e=>e.result)}_batch(e){return this.#M({type:"batch",batch:e}).then(e=>e.result)}_describe(e){return this.#M({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(e=>e.result)}_sequence(e){return this.#M({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(e=>{})}getAutocommit(){return this.#A._ensureVersion(3,"getAutocommit()"),this.#M({type:"get_autocommit"}).then(e=>e.isAutocommit)}#M(e){return new Promise((t,s)=>{this.#j({type:"pipeline",request:e,responseCallback:t,errorCallback:s})})}_openCursor(e){return new Promise((t,s)=>{this.#j({type:"cursor",batch:e,cursorCallback:t,errorCallback:s})})}_cursorClosed(e){if(e!==this.#P)throw new G("Cursor was closed, but it was not associated with the stream");this.#P=void 0,i(()=>this.#$())}close(){this._setClosed(new V("Stream was manually closed"))}closeGracefully(){this.#B=!0,i(()=>this.#$())}get closed(){return void 0!==this.#w||this.#B}_setClosed(e){if(void 0===this.#w){for(this.#w=e,void 0!==this.#P&&this.#P._setClosed(e),this.#A._streamClosed(this);;){let t=this.#L.shift();if(void 0!==t)t.errorCallback(e);else break}(void 0!==this.#ef||this.#ed)&&!this.#ep&&(this.#L.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#ep=!0,i(()=>this.#$()))}}#j(e){if(void 0!==this.#w)throw new z("Stream is closed",this.#w);if(this.#B)throw new z("Stream is closing",void 0);this.#L.push(e),i(()=>this.#$())}#$(){if(this.#ed||void 0!==this.#P)return;if(this.#B&&0===this.#L.length)return void this._setClosed(new V("Stream was gracefully closed"));let e=this.#A._endpoint;if(void 0===e)return void this.#A._endpointPromise.then(()=>this.#$(),e=>this._setClosed(e));let t=this.#L.shift();if(void 0!==t)if("pipeline"===t.type){let s=[t];for(;;){let e=this.#L.first();if(void 0!==e&&"pipeline"===e.type)s.push(e),this.#L.shift();else if(void 0===e&&this.#B&&!this.#ep){s.push({type:"pipeline",request:{type:"close"},responseCallback:()=>void 0,errorCallback:()=>void 0}),this.#ep=!0;break}else break}this.#ey(e,s)}else if("cursor"===t.type)this.#em(e,t);else throw ep(t,"Impossible type of QueueEntry")}#ey(e,t){this.#eg(()=>this.#ew(t,e),t=>sh(t,e.encoding),e=>e.baton,e=>e.baseUrl,e=>(function(e,t){if(t.results.length!==e.length)throw new F("Server returned unexpected number of pipeline results");for(let s=0;s<e.length;++s){let r=t.results[s],i=e[s];if("ok"===r.type){if(r.response.type!==i.request.type)throw new F("Received unexpected type of response");i.responseCallback(r.response)}else if("error"===r.type)i.errorCallback(eI(r.error));else if("none"===r.type)throw new F("Received unrecognized type of StreamResult");else throw ep(r,"Received impossible type of StreamResult")}})(t,e),e=>t.forEach(t=>t.errorCallback(e)))}#em(e,t){let s=new t6(this,e.encoding);this.#P=s,this.#eg(()=>this.#eb(t,e),e=>s.open(e),e=>e.baton,e=>e.baseUrl,e=>t.cursorCallback(s),e=>t.errorCallback(e))}#eg(e,t,s,r,i,o){let n;try{let t=e();n=(0,this.#U)(t)}catch(e){n=Promise.reject(e)}this.#ed=!0,n.then(e=>e.ok?t(e):sc(e).then(e=>{throw e})).then(e=>{this.#ef=s(e),this.#eh=r(e)??this.#eh,i(e)}).catch(e=>{this._setClosed(e),o(e)}).finally(()=>{this.#ed=!1,this.#$()})}#ew(e,t){return this.#ev(new URL(t.pipelinePath,this.#eh),{baton:this.#ef,requests:e.map(e=>e.request)},t.encoding,t8,t7)}#eb(e,t){if(void 0===t.cursorPath)throw new Y(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${t.version}.`);return this.#ev(new URL(t.cursorPath,this.#eh),{baton:this.#ef,batch:e.batch},t.encoding,t4,su)}#ev(e,t,s,r,i){let o,n;if("json"===s)o=ea(t,r),n="application/json";else if("protobuf"===s)o=ef(t,i),n="application/x-protobuf";else throw ep(s,"Impossible encoding");let a=new tW;return a.set("content-type",n),void 0!==this.#ec&&a.set("authorization",`Bearer ${this.#ec}`),new tz(e.toString(),{method:"POST",headers:a,body:o})}}async function sh(e,t){if("json"===t){var s=er(await e.json());let t=X(s.baton);return{baton:t,baseUrl:X(s.base_url),results:ei(s.results,tJ)}}if("protobuf"===t)return eh(new Uint8Array(await e.arrayBuffer()),tG);throw await e.body?.cancel(),ep(t,"Impossible encoding")}async function sc(e){let t=e.headers.get("content-type")??"text/plain",s=`Server returned HTTP status ${e.status}`;if("application/json"===t){let t=await e.json();return"message"in t?eI(t):new J(s,e.status)}if("text/plain"===t){let t=(await e.text()).trim();return""!==t&&(s+=`: ${t}`),new J(s,e.status)}return await e.body?.cancel(),new J(s,e.status)}let sf=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],sd={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};class sp extends D{#e_;#ec;#U;#w;#eq;_endpointPromise;_endpoint;constructor(e,t,s,r=2){super(),this.#e_=e,this.#ec=t,this.#U=s??tQ,this.#w=void 0,this.#eq=new Set,3==r?(this._endpointPromise=sy(this.#U,this.#e_),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#N(e))):(this._endpointPromise=Promise.resolve(sd),this._endpointPromise.then(e=>this._endpoint=e,e=>this.#N(e)))}async getVersion(){return void 0!==this._endpoint?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,t){if(!(e<=sd.version)){if(void 0===this._endpoint)throw new Y(`${t} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new Y(`${t} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(void 0!==this.#w)throw new z("Client is closed",this.#w);let e=new sl(this,this.#e_,this.#ec,this.#U);return this.#eq.add(e),e}_streamClosed(e){this.#eq.delete(e)}close(){this.#N(new V("Client was manually closed"))}get closed(){return void 0!==this.#w}#N(e){if(void 0===this.#w)for(let t of(this.#w=e,Array.from(this.#eq)))t._setClosed(new z("Client was closed",e))}}async function sy(e,t){for(let s of sf){let r=new tz(new URL(s.versionPath,t).toString(),{method:"GET"}),i=await e(r);if(await i.arrayBuffer(),i.ok)return s}return sd}function sm(e,t,s=2){if(void 0===r)throw new W("WebSockets are not supported in this environment");var i=void 0;return i=3==s?Array.from(tV.keys()):Array.from(tD.keys()),new tF(new r(e,i),t)}function sg(e,t,s,r=2){return new sp(e instanceof URL?e:new URL(e),t,s,r)}class sw{#eS;#eI;#eC;constructor(e,t){this.#eS=e,this.#eI=t,this.#eC=void 0}execute(e){return this.batch([e]).then(e=>e[0])}async batch(e){let t=this._getStream();if(t.closed)throw new o("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{let s,r=e.map(sv);if(void 0===this.#eC){this._getSqlCache().apply(r);let e=t.batch(this.#eI>=3),i=e.step(),o=i.run(B(this.#eS)),n=i;s=r.map(t=>{let s=e.step().condition(eO.ok(n));this.#eI>=3&&s.condition(eO.not(eO.isAutocommit(e)));let r=s.query(t);return r.catch(()=>void 0),n=s,r}),this.#eC=e.execute().then(()=>o).then(()=>void 0);try{await this.#eC}catch(e){throw this.close(),e}}else{let e;this.#eI<3&&await this.#eC,this._getSqlCache().apply(r);let i=t.batch(this.#eI>=3);s=r.map(t=>{let s=i.step();void 0!==e&&s.condition(eO.ok(e)),this.#eI>=3&&s.condition(eO.not(eO.isAutocommit(i)));let r=s.query(t);return r.catch(()=>void 0),e=s,r}),await i.execute()}let i=[];for(let e of s){let t=await e;if(void 0===t)throw new o("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");i.push(s_(t))}return i}catch(e){throw sq(e)}}async executeMultiple(e){let t=this._getStream();if(t.closed)throw new o("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(void 0===this.#eC){this.#eC=t.run(B(this.#eS)).then(()=>void 0);try{await this.#eC}catch(e){throw this.close(),e}}else await this.#eC;await t.sequence(e)}catch(e){throw sq(e)}}async rollback(){try{let e=this._getStream();if(e.closed||void 0===this.#eC)return;let t=e.run("ROLLBACK").catch(e=>{throw sq(e)});e.closeGracefully(),await t}catch(e){throw sq(e)}finally{this.close()}}async commit(){try{let e=this._getStream();if(e.closed)throw new o("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(void 0===this.#eC)return;await this.#eC;let t=e.run("COMMIT").catch(e=>{throw sq(e)});e.closeGracefully(),await t}catch(e){throw sq(e)}finally{this.close()}}}async function sb(e,t,s,r,i=!1){i&&s.step().run("PRAGMA foreign_keys=off");let n=s.step(),a=n.run(B(e)),u=n,l=r.map(e=>{let r=s.step().condition(eO.ok(u));t>=3&&r.condition(eO.not(eO.isAutocommit(s)));let i=r.query(e);return u=r,i}),h=s.step().condition(eO.ok(u));t>=3&&h.condition(eO.not(eO.isAutocommit(s)));let c=h.run("COMMIT");s.step().condition(eO.not(eO.ok(h))).run("ROLLBACK").catch(e=>void 0),i&&s.step().run("PRAGMA foreign_keys=on"),await s.execute();let f=[];for(let e of(await a,l)){let t=await e;if(void 0===t)throw new o("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");f.push(s_(t))}return await c,f}function sv(e){let t,s;Array.isArray(e)?[t,s]=e:"string"==typeof e?t=e:(t=e.sql,s=e.args);let r=new ek(t);if(s)if(Array.isArray(s))r.bindIndexes(s);else for(let[e,t]of Object.entries(s))r.bindName(e,t);return r}function s_(e){let t=e.columnNames.map(e=>e??""),s=e.columnDecltypes.map(e=>e??""),r=e.rows;return new N(t,s,r,e.affectedRowCount,void 0!==e.lastInsertRowid?e.lastInsertRowid:void 0)}function sq(e){if(e instanceof V){let t=function e(t){if(t instanceof Q&&void 0!==t.code)return t.code;if(t instanceof F)return"HRANA_PROTO_ERROR";if(t instanceof z)return t.cause instanceof V?e(t.cause):"HRANA_CLOSED_ERROR";if(t instanceof H)return"HRANA_WEBSOCKET_ERROR";if(t instanceof J)return"SERVER_ERROR";else if(t instanceof Y)return"PROTOCOL_VERSION_ERROR";else if(t instanceof G)return"INTERNAL_ERROR";else return"UNKNOWN"}(e);return new o(e.message,t,void 0,e)}return e}class sS{#m;#eA;capacity;constructor(e,t){this.#m=e,this.#eA=new sI,this.capacity=t}apply(e){if(this.capacity<=0)return;let t=new Set;for(let s of e){if("string"!=typeof s.sql)continue;let e=s.sql;if(e.length>=5e3)continue;let r=this.#eA.get(e);if(void 0===r){for(;this.#eA.size+1>this.capacity;){let[e,s]=this.#eA.peekLru();if(t.has(s))break;s.close(),this.#eA.delete(e)}this.#eA.size+1<=this.capacity&&(r=this.#m.storeSql(e),this.#eA.set(e,r))}void 0!==r&&(s.sql=r,t.add(r))}}}class sI{#eR;constructor(){this.#eR=new Map}get(e){let t=this.#eR.get(e);return void 0!==t&&(this.#eR.delete(e),this.#eR.set(e,t)),t}set(e,t){this.#eR.set(e,t)}peekLru(){for(let e of this.#eR.entries())return e}delete(e){this.#eR.delete(e)}get size(){return this.#eR.size}}var sC=s(3756);class sA{#e_;#ek;#eE;#ex;#eT;closed;protocol;#eU;#eO;constructor(e,t,s,r,i){this.#e_=t,this.#ek=s,this.#eE=r,this.#ex=this.#eL(e),this.#eT=void 0,this.closed=!1,this.protocol="ws",this.#eO=sC(i)}async limit(e){return this.#eO(e)}async execute(e,t){let s;return s="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{let e=await this.#eP();try{let t=sv(s);e.conn.sqlCache.apply([t]);let r=e.stream.query(t);e.stream.closeGracefully();let i=await r;return s_(i)}catch(e){throw sq(e)}finally{this._closeStream(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{let s=await this.#eP();try{let r=e.map(e=>Array.isArray(e)?{sql:e[0],args:e[1]||[]}:e).map(sv),i=await s.conn.client.getVersion();s.conn.sqlCache.apply(r);let o=s.stream.batch(i>=3),n=sb(t,i,o,r);return await n}catch(e){throw sq(e)}finally{this._closeStream(s)}})}async migrate(e){return this.limit(async()=>{let t=await this.#eP();try{let s=e.map(sv),r=await t.conn.client.getVersion(),i=t.stream.batch(r>=3),o=sb("deferred",r,i,s,!0);return await o}catch(e){throw sq(e)}finally{this._closeStream(t)}})}async transaction(e="write"){return this.limit(async()=>{let t=await this.#eP();try{let s=await t.conn.client.getVersion();return new sR(this,t,e,s)}catch(e){throw this._closeStream(t),sq(e)}})}async executeMultiple(e){return this.limit(async()=>{let t=await this.#eP();try{let s=t.stream.sequence(e);t.stream.closeGracefully(),await s}catch(e){throw sq(e)}finally{this._closeStream(t)}})}sync(){throw new o("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async #eP(){if(this.closed)throw new o("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#ex.openTime.valueOf()>6e4&&void 0===this.#eT){let e=this.#eL();this.#eT=e,e.client.getVersion().then(t=>{this.#ex!==e&&0===this.#ex.streamStates.size&&this.#ex.client.close(),this.#ex=e,this.#eT=void 0},e=>{this.#eT=void 0})}if(this.#ex.client.closed)try{void 0!==this.#eT?this.#ex=this.#eT:this.#ex=this.#eL()}catch(e){throw sq(e)}let e=this.#ex;try{void 0===e.useSqlCache&&(e.useSqlCache=await e.client.getVersion()>=2,e.useSqlCache&&(e.sqlCache.capacity=100));let t=e.client.openStream();t.intMode=this.#eE;let s={conn:e,stream:t};return e.streamStates.add(s),s}catch(e){throw sq(e)}}#eL(e){try{return{client:e??=sm(this.#e_,this.#ek),useSqlCache:void 0,sqlCache:new sS(e,0),openTime:new Date,streamStates:new Set}}catch(e){throw sq(e)}}async reconnect(){try{for(let e of Array.from(this.#ex.streamStates))try{e.stream.close()}catch{}this.#ex.client.close()}catch{}if(this.#eT){try{this.#eT.client.close()}catch{}this.#eT=void 0}let e=this.#eL(),t=await e.client.getVersion();e.useSqlCache=t>=2,e.useSqlCache&&(e.sqlCache.capacity=100),this.#ex=e,this.closed=!1}_closeStream(e){e.stream.close();let t=e.conn;t.streamStates.delete(e),0===t.streamStates.size&&t!==this.#ex&&t.client.close()}close(){if(this.#ex.client.close(),this.closed=!0,this.#eT){try{this.#eT.client.close()}catch{}this.#eT=void 0}this.closed=!0}}class sR extends sw{#A;#eB;constructor(e,t,s,r){super(s,r),this.#A=e,this.#eB=t}_getStream(){return this.#eB.stream}_getSqlCache(){return this.#eB.conn.sqlCache}close(){this.#A._closeStream(this.#eB)}get closed(){return this.#eB.stream.closed}}class sk{#A;protocol;#e_;#eE;#eN;#eM;#ek;#eO;constructor(e,t,s,r,i){this.#e_=e,this.#ek=t,this.#eE=s,this.#eN=r,this.#eM=i,this.#A=sg(this.#e_,this.#ek,this.#eN),this.#A.intMode=this.#eE,this.protocol="http",this.#eO=sC(this.#eM)}async limit(e){return this.#eO(e)}async execute(e,t){let s;return s="string"==typeof e?{sql:e,args:t||[]}:e,this.limit(async()=>{try{let e,t=sv(s),r=this.#A.openStream();try{e=r.query(t)}finally{r.closeGracefully()}let i=await e;return s_(i)}catch(e){throw sq(e)}})}async batch(e,t="deferred"){return this.limit(async()=>{try{let s,r=e.map(e=>Array.isArray(e)?{sql:e[0],args:e[1]||[]}:e).map(sv),i=await this.#A.getVersion(),o=this.#A.openStream();try{new sS(o,30).apply(r);let e=o.batch(!1);s=sb(t,i,e,r)}finally{o.closeGracefully()}return await s}catch(e){throw sq(e)}})}async migrate(e){return this.limit(async()=>{try{let t,s=e.map(sv),r=await this.#A.getVersion(),i=this.#A.openStream();try{let e=i.batch(!1);t=sb("deferred",r,e,s,!0)}finally{i.closeGracefully()}return await t}catch(e){throw sq(e)}})}async transaction(e="write"){return this.limit(async()=>{try{let t=await this.#A.getVersion();return new sE(this.#A.openStream(),e,t)}catch(e){throw sq(e)}})}async executeMultiple(e){return this.limit(async()=>{try{let t,s=this.#A.openStream();try{t=s.sequence(e)}finally{s.closeGracefully()}await t}catch(e){throw sq(e)}})}sync(){throw new o("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#A.close()}async reconnect(){try{this.closed||this.#A.close()}finally{this.#A=sg(this.#e_,this.#ek,this.#eN),this.#A.intMode=this.#eE}}get closed(){return this.#A.closed}}class sE extends sw{#R;#ej;constructor(e,t,s){super(t,s),this.#R=e,this.#ej=new sS(e,30)}_getStream(){return this.#R}_getSqlCache(){return this.#ej}close(){this.#R.close()}get closed(){return this.#R.closed}}function sx(e){return function(e){if("ws"===e.scheme||"wss"===e.scheme){let t;if("wss"!==e.scheme&&"ws"!==e.scheme)throw new o(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${P}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new o("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("ws"===e.scheme&&e.tls)throw new o('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("wss"===e.scheme&&!e.tls)throw new o('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");let s=l(e.scheme,e.authority,e.path);try{t=sm(s,e.authToken)}catch(t){if(t instanceof W){let t="wss"===e.scheme?"https":"http",s=l(t,e.authority,e.path);throw new o(`This environment does not support WebSockets, please switch to the HTTP client by using a "${t}:" URL (${JSON.stringify(s)}). For more information, please read ${P}`,"WEBSOCKETS_NOT_SUPPORTED")}throw sq(t)}return new sA(t,s,e.authToken,e.intMode,e.concurrency)}if("http"===e.scheme||"https"===e.scheme){if("https"!==e.scheme&&"http"!==e.scheme)throw new o(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${P}`,"URL_SCHEME_NOT_SUPPORTED");if(void 0!==e.encryptionKey)throw new o("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if("http"===e.scheme&&e.tls)throw new o('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if("https"===e.scheme&&!e.tls)throw new o('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");return new sk(l(e.scheme,e.authority,e.path),e.authToken,e.intMode,e.fetch,e.concurrency)}throw new o(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(e.scheme+":")}. For more information, please read ${P}`,"URL_SCHEME_NOT_SUPPORTED")}(function(e,t){let s,r;if("object"!=typeof e)throw TypeError(`Expected client configuration as object, got ${typeof e}`);let{url:i,authToken:l,tls:h,intMode:c,concurrency:f}=e;f=Math.max(0,f||20),c??="number";let d=[];i===$&&(i="file::memory:");let p=function(e){let t=n.exec(e);if(null===t)throw new o(`The URL '${e}' is not in a valid format`,"URL_INVALID");let s=t.groups,r=s.scheme,i=void 0!==s.authority?function(e){let t=a.exec(e);if(null===t)throw new o("The authority part of the URL is not in a valid format","URL_INVALID");let s=t.groups,r=u(s.host_br??s.host);return{host:r,port:s.port?parseInt(s.port,10):void 0,userinfo:void 0!==s.username?{username:u(s.username),password:void 0!==s.password?u(s.password):void 0}:void 0}}(s.authority):void 0,l=u(s.path);return{scheme:r,authority:i,path:l,query:void 0!==s.query?function(e){let t=e.split("&"),s=[];for(let e of t){let t,r;if(""===e)continue;let i=e.indexOf("=");i<0?(t=e,r=""):(t=e.substring(0,i),r=e.substring(i+1)),s.push({key:u(t.replaceAll("+"," ")),value:u(r.replaceAll("+"," "))})}return{pairs:s}}(s.query):void 0,fragment:void 0!==s.fragment?u(s.fragment):void 0}}(i),y=p.scheme.toLowerCase(),m="file"===y&&p.path===$&&void 0===p.authority;for(let{key:e,value:t}of(s=m?{cache:{values:["shared","private"],update:(e,t)=>d.push(`${e}=${t}`)}}:{tls:{values:["0","1"],update:(e,t)=>h="1"===t},authToken:{update:(e,t)=>l=t}},p.query?.pairs??[])){if(!Object.hasOwn(s,e))throw new o(`Unsupported URL query parameter ${JSON.stringify(e)}`,"URL_PARAM_NOT_SUPPORTED");let r=s[e];if(void 0!==r.values&&!r.values.includes(t))throw new o(`Unknown value for the "${e}" query argument: ${JSON.stringify(t)}. Supported values are: [${r.values.map(e=>'"'+e+'"').join(", ")}]`,"URL_INVALID");void 0!==r.update&&r?.update(e,t)}let g=0===d.length?"":`?${d.join("&")}`,w=p.path+g;if("libsql"===y)if(!1===h){if(p.authority?.port===void 0)throw new o('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");r=t?"http":"ws"}else r=t?"https":"wss";else r=y;if("http"===r||"ws"===r?h??=!1:h??=!0,"http"!==r&&"ws"!==r&&"https"!==r&&"wss"!==r&&"file"!==r)throw new o(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(p.scheme+":")}. For more information, please read ${P}`,"URL_SCHEME_NOT_SUPPORTED");if("number"!==c&&"bigint"!==c&&"string"!==c)throw TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(c)}`);if(void 0!==p.fragment)throw new o(`URL fragments are not supported: ${JSON.stringify("#"+p.fragment)}`,"URL_INVALID");return m?{scheme:"file",tls:!1,path:w,intMode:c,concurrency:f,syncUrl:e.syncUrl,syncInterval:e.syncInterval,readYourWrites:e.readYourWrites,offline:e.offline,fetch:e.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0}:{scheme:r,tls:h,authority:p.authority,path:w,authToken:l,intMode:c,concurrency:f,encryptionKey:e.encryptionKey,syncUrl:e.syncUrl,syncInterval:e.syncInterval,readYourWrites:e.readYourWrites,offline:e.offline,fetch:e.fetch}}(e,!0))}},3756:e=>{function t(e,t){var s=!1,r=this;return Promise.all(e.map(function(){var e=arguments;return r(function(){if(!s)return t.apply(void 0,e).catch(function(e){throw s=!0,e})})}))}function s(e){return e.queue=0,e.map=t,e}e.exports=function(e){return e?s(function(e){var t=0,s=[];function r(){var r;--t<e&&(r=s.shift(),o.queue=s.length,r&&i(r.fn).then(r.resolve).catch(r.reject))}function i(e){t++;try{return Promise.resolve(e()).then(function(e){return r(),e},function(e){throw r(),e})}catch(e){return r(),Promise.reject(e)}}var o=function(r){return t>=e?new Promise(function(e,t){s.push({fn:r,resolve:e,reject:t}),o.queue=s.length}):i(r)};return o}(e)):s(function(e){return e()})}},7536:e=>{!function(){var t={675:function(e,t){"use strict";t.byteLength=function(e){var t=u(e),s=t[0],r=t[1];return(s+r)*3/4-r},t.toByteArray=function(e){var t,s,o=u(e),n=o[0],a=o[1],l=new i((n+a)*3/4-a),h=0,c=a>0?n-4:n;for(s=0;s<c;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],l[h++]=t>>16&255,l[h++]=t>>8&255,l[h++]=255&t;return 2===a&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,l[h++]=255&t),1===a&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,l[h++]=t>>8&255,l[h++]=255&t),l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],n=0,a=r-i;n<a;n+=16383)o.push(function(e,t,r){for(var i,o=[],n=t;n<r;n+=3)i=(e[n]<<16&0xff0000)+(e[n+1]<<8&65280)+(255&e[n+2]),o.push(s[i>>18&63]+s[i>>12&63]+s[i>>6&63]+s[63&i]);return o.join("")}(e,n,n+16383>a?a:n+16383));return 1===i?o.push(s[(t=e[r-1])>>2]+s[t<<4&63]+"=="):2===i&&o.push(s[(t=(e[r-2]<<8)+e[r-1])>>10]+s[t>>4&63]+s[t<<2&63]+"="),o.join("")};for(var s=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=o.length;n<a;++n)s[n]=o[n],r[o.charCodeAt(n)]=n;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");-1===s&&(s=t);var r=s===t?0:4-s%4;return[s,r]}r[45]=62,r[95]=63},72:function(e,t,s){"use strict";var r=s(675),i=s(783),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function n(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,s){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return u(e,t,s)}function u(e,t,s){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);var o=0|d(r,i),u=n(o),l=u.write(r,i);return l!==o&&(u=u.slice(0,l)),u}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(E(e,ArrayBuffer)||e&&E(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(E(e,SharedArrayBuffer)||e&&E(e.buffer,SharedArrayBuffer)))return function(e,t,s){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(s||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===s?new Uint8Array(e):void 0===s?new Uint8Array(e,t):new Uint8Array(e,t,s),a.prototype),r}(e,t,s);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return a.from(h,t,s);var p=function(e){if(a.isBuffer(e)){var t=0|f(e.length),s=n(t);return 0===s.length||e.copy(s,0,0,t),s}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?n(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,s);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),n(e<0?0:0|f(e))}function c(e){for(var t=e.length<0?0:0|f(e.length),s=n(t),r=0;r<t;r+=1)s[r]=255&e[r];return s}t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,s){return u(e,t,s)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,s){return(l(e),e<=0)?n(e):void 0!==t?"string"==typeof s?n(e).fill(t,s):n(e).fill(t):n(e)},a.allocUnsafe=function(e){return h(e)},a.allocUnsafeSlow=function(e){return h(e)};function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||E(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var s=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===s)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return R(e).length;default:if(i)return r?-1:C(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,s){var i,o,n,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===s||s>this.length)&&(s=this.length),s<=0||(s>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,s){var r=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>r)&&(s=r);for(var i="",o=t;o<s;++o)i+=x[e[o]];return i}(this,t,s);case"utf8":case"utf-8":return w(this,t,s);case"ascii":return function(e,t,s){var r="";s=Math.min(e.length,s);for(var i=t;i<s;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,s);case"latin1":case"binary":return function(e,t,s){var r="";s=Math.min(e.length,s);for(var i=t;i<s;++i)r+=String.fromCharCode(e[i]);return r}(this,t,s);case"base64":return i=this,o=t,n=s,0===o&&n===i.length?r.fromByteArray(i):r.fromByteArray(i.slice(o,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,s){for(var r=e.slice(t,s),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}(this,t,s);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function y(e,t,s){var r=e[t];e[t]=e[s],e[s]=r}function m(e,t,s,r,i){var o;if(0===e.length)return -1;if("string"==typeof s?(r=s,s=0):s>0x7fffffff?s=0x7fffffff:s<-0x80000000&&(s=-0x80000000),(o=s*=1)!=o&&(s=i?0:e.length-1),s<0&&(s=e.length+s),s>=e.length)if(i)return -1;else s=e.length-1;else if(s<0)if(!i)return -1;else s=0;if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:g(e,t,s,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,s);else return Uint8Array.prototype.lastIndexOf.call(e,t,s);return g(e,[t],s,r,i)}throw TypeError("val must be string, number or Buffer")}function g(e,t,s,r,i){var o,n=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;n=2,a/=2,u/=2,s/=2}function l(e,t){return 1===n?e[t]:e.readUInt16BE(t*n)}if(i){var h=-1;for(o=s;o<a;o++)if(l(e,o)===l(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===u)return h*n}else -1!==h&&(o-=o-h),h=-1}else for(s+u>a&&(s=a-u),o=s;o>=0;o--){for(var c=!0,f=0;f<u;f++)if(l(e,o+f)!==l(t,f)){c=!1;break}if(c)return o}return -1}a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(E(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),E(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var s=e.length,r=t.length,i=0,o=Math.min(s,r);i<o;++i)if(e[i]!==t[i]){s=e[i],r=t[i];break}return s<r?-1:+(r<s)},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(s=0,t=0;s<e.length;++s)t+=e[s].length;var s,r=a.allocUnsafe(t),i=0;for(s=0;s<e.length;++s){var o=e[s];if(E(o,Uint8Array)&&(o=a.from(o)),!a.isBuffer(o))throw TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",s=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(e+=" ... "),"<Buffer "+e+">"},o&&(a.prototype[o]=a.prototype.inspect),a.prototype.compare=function(e,t,s,r,i){if(E(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||s>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=s)return 0;if(r>=i)return -1;if(t>=s)return 1;if(t>>>=0,s>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,n=s-t,u=Math.min(o,n),l=this.slice(r,i),h=e.slice(t,s),c=0;c<u;++c)if(l[c]!==h[c]){o=l[c],n=h[c];break}return o<n?-1:+(n<o)},a.prototype.includes=function(e,t,s){return -1!==this.indexOf(e,t,s)},a.prototype.indexOf=function(e,t,s){return m(this,e,t,s,!0)},a.prototype.lastIndexOf=function(e,t,s){return m(this,e,t,s,!1)};function w(e,t,s){s=Math.min(e.length,s);for(var r=[],i=t;i<s;){var o,n,a,u,l=e[i],h=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c<=s)switch(c){case 1:l<128&&(h=l);break;case 2:(192&(o=e[i+1]))==128&&(u=(31&l)<<6|63&o)>127&&(h=u);break;case 3:o=e[i+1],n=e[i+2],(192&o)==128&&(192&n)==128&&(u=(15&l)<<12|(63&o)<<6|63&n)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:o=e[i+1],n=e[i+2],a=e[i+3],(192&o)==128&&(192&n)==128&&(192&a)==128&&(u=(15&l)<<18|(63&o)<<12|(63&n)<<6|63&a)>65535&&u<1114112&&(h=u)}null===h?(h=65533,c=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=c}var f=r,d=f.length;if(d<=4096)return String.fromCharCode.apply(String,f);for(var p="",y=0;y<d;)p+=String.fromCharCode.apply(String,f.slice(y,y+=4096));return p}function b(e,t,s){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>s)throw RangeError("Trying to access beyond buffer length")}function v(e,t,s,r,i,o){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw RangeError('"value" argument is out of bounds');if(s+r>e.length)throw RangeError("Index out of range")}function _(e,t,s,r,i,o){if(s+r>e.length||s<0)throw RangeError("Index out of range")}function q(e,t,s,r,o){return t*=1,s>>>=0,o||_(e,t,s,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,s,r,23,4),s+4}function S(e,t,s,r,o){return t*=1,s>>>=0,o||_(e,t,s,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,s,r,52,8),s+8}a.prototype.write=function(e,t,s,r){if(void 0===t)r="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)r=t,s=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(s)?(s>>>=0,void 0===r&&(r="utf8")):(r=s,s=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,o,n,a,u,l,h,c,f=this.length-t;if((void 0===s||s>f)&&(s=f),e.length>0&&(s<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var d=!1;;)switch(r){case"hex":return function(e,t,s,r){s=Number(s)||0;var i=e.length-s;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var n=0;n<r;++n){var a,u=parseInt(t.substr(2*n,2),16);if((a=u)!=a)break;e[s+n]=u}return n}(this,e,t,s);case"utf8":case"utf-8":return i=t,o=s,k(C(e,this.length-i),this,i,o);case"ascii":return n=t,a=s,k(A(e),this,n,a);case"latin1":case"binary":return function(e,t,s,r){return k(A(t),e,s,r)}(this,e,t,s);case"base64":return u=t,l=s,k(R(e),this,u,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=s,k(function(e,t){for(var s,r,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(s=e.charCodeAt(o))>>8,i.push(s%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(d)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),d=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){var s=this.length;e=~~e,t=void 0===t?s:~~t,e<0?(e+=s)<0&&(e=0):e>s&&(e=s),t<0?(t+=s)<0&&(t=0):t>s&&(t=s),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUIntLE=function(e,t,s){e>>>=0,t>>>=0,s||b(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUIntBE=function(e,t,s){e>>>=0,t>>>=0,s||b(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,s){e>>>=0,t>>>=0,s||b(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,s){e>>>=0,t>>>=0,s||b(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?0xffff0000|s:s},a.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?0xffff0000|s:s},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,s,r){if(e*=1,t>>>=0,s>>>=0,!r){var i=Math.pow(2,8*s)-1;v(this,e,t,s,i,0)}var o=1,n=0;for(this[t]=255&e;++n<s&&(o*=256);)this[t+n]=e/o&255;return t+s},a.prototype.writeUIntBE=function(e,t,s,r){if(e*=1,t>>>=0,s>>>=0,!r){var i=Math.pow(2,8*s)-1;v(this,e,t,s,i,0)}var o=s-1,n=1;for(this[t+o]=255&e;--o>=0&&(n*=256);)this[t+o]=e/n&255;return t+s},a.prototype.writeUInt8=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,s,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*s-1);v(this,e,t,s,i-1,-i)}var o=0,n=1,a=0;for(this[t]=255&e;++o<s&&(n*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/n|0)-a&255;return t+s},a.prototype.writeIntBE=function(e,t,s,r){if(e*=1,t>>>=0,!r){var i=Math.pow(2,8*s-1);v(this,e,t,s,i-1,-i)}var o=s-1,n=1,a=0;for(this[t+o]=255&e;--o>=0&&(n*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/n|0)-a&255;return t+s},a.prototype.writeInt8=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,s){return e*=1,t>>>=0,s||v(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,s){return q(this,e,t,!0,s)},a.prototype.writeFloatBE=function(e,t,s){return q(this,e,t,!1,s)},a.prototype.writeDoubleLE=function(e,t,s){return S(this,e,t,!0,s)},a.prototype.writeDoubleBE=function(e,t,s){return S(this,e,t,!1,s)},a.prototype.copy=function(e,t,s,r){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(s||(s=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<s&&(r=s),r===s||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-s&&(r=e.length-t+s);var i=r-s;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,s,r);else if(this===e&&s<t&&t<r)for(var o=i-1;o>=0;--o)e[o+t]=this[o+s];else Uint8Array.prototype.set.call(e,this.subarray(s,r),t);return i},a.prototype.fill=function(e,t,s,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,o=e.charCodeAt(0);("utf8"===r&&o<128||"latin1"===r)&&(e=o)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<s)throw RangeError("Out of range index");if(s<=t)return this;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(i=t;i<s;++i)this[i]=e;else{var n=a.isBuffer(e)?e:a.from(e,r),u=n.length;if(0===u)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<s-t;++i)this[i+t]=n[i%u]}return this};var I=/[^+/0-9A-Za-z-_]/g;function C(e,t){t=t||1/0;for(var s,r=e.length,i=null,o=[],n=0;n<r;++n){if((s=e.charCodeAt(n))>55295&&s<57344){if(!i){if(s>56319||n+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=s;continue}if(s<56320){(t-=3)>-1&&o.push(239,191,189),i=s;continue}s=(i-55296<<10|s-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,s<128){if((t-=1)<0)break;o.push(s)}else if(s<2048){if((t-=2)<0)break;o.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;o.push(s>>12|224,s>>6&63|128,63&s|128)}else if(s<1114112){if((t-=4)<0)break;o.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}else throw Error("Invalid code point")}return o}function A(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}function R(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,s,r){for(var i=0;i<r&&!(i+s>=t.length)&&!(i>=e.length);++i)t[i+s]=e[i];return i}function E(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var x=function(){for(var e="0123456789abcdef",t=Array(256),s=0;s<16;++s)for(var r=16*s,i=0;i<16;++i)t[r+i]=e[s]+e[i];return t}()},783:function(e,t){t.read=function(e,t,s,r,i){var o,n,a=8*i-r-1,u=(1<<a)-1,l=u>>1,h=-7,c=s?i-1:0,f=s?-1:1,d=e[t+c];for(c+=f,o=d&(1<<-h)-1,d>>=-h,h+=a;h>0;o=256*o+e[t+c],c+=f,h-=8);for(n=o&(1<<-h)-1,o>>=-h,h+=r;h>0;n=256*n+e[t+c],c+=f,h-=8);if(0===o)o=1-l;else{if(o===u)return n?NaN:1/0*(d?-1:1);n+=Math.pow(2,r),o-=l}return(d?-1:1)*n*Math.pow(2,o-r)},t.write=function(e,t,s,r,i,o){var n,a,u,l=8*o-i-1,h=(1<<l)-1,c=h>>1,f=5960464477539062e-23*(23===i),d=r?0:o-1,p=r?1:-1,y=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),n=h):(n=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-n))<1&&(n--,u*=2),n+c>=1?t+=f/u:t+=f*Math.pow(2,1-c),t*u>=2&&(n++,u/=2),n+c>=h?(a=0,n=h):n+c>=1?(a=(t*u-1)*Math.pow(2,i),n+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,i),n=0));i>=8;e[s+d]=255&a,d+=p,a/=256,i-=8);for(n=n<<i|a,l+=i;l>0;e[s+d]=255&n,d+=p,n/=256,l-=8);e[s+d-p]|=128*y}}},s={};function r(e){var i=s[e];if(void 0!==i)return i.exports;var o=s[e]={exports:{}},n=!0;try{t[e](o,o.exports,r),n=!1}finally{n&&delete s[e]}return o.exports}r.ab="//",e.exports=r(72)}()}}]);